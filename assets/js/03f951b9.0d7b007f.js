"use strict";(self.webpackChunkguardian=self.webpackChunkguardian||[]).push([[705],{3905:function(e,n,a){a.d(n,{Zo:function(){return c},kt:function(){return g}});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function p(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=t.createContext({}),s=function(e){var n=t.useContext(l),a=n;return e&&(a="function"==typeof e?e(n):p(p({},n),e)),a},c=function(e){var n=s(e.components);return t.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=s(a),g=r,m=d["".concat(l,".").concat(g)]||d[g]||u[g]||i;return a?t.createElement(m,p(p({ref:n},c),{},{components:a})):t.createElement(m,p({ref:n},c))}));function g(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,p=new Array(i);p[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,p[1]=o;for(var s=2;s<i;s++)p[s]=a[s];return t.createElement.apply(null,p)}return t.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5206:function(e,n,a){a.r(n),a.d(n,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return c},default:function(){return d}});var t=a(7462),r=a(3366),i=(a(7294),a(3905)),p=["components"],o={},l="Managing appeals",s={unversionedId:"guides/managing-appeals",id:"guides/managing-appeals",isDocsHomePage:!1,title:"Managing appeals",description:"Creating appeal",source:"@site/docs/guides/managing-appeals.md",sourceDirName:"guides",slug:"/guides/managing-appeals",permalink:"/guardian/docs/guides/managing-appeals",editUrl:"https://github.com/odpf/guardian/edit/master/docs/docs/guides/managing-appeals.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Managing resources",permalink:"/guardian/docs/guides/managing-resources"},next:{title:"Big Query",permalink:"/guardian/docs/providers/bigquery"}},c=[{value:"Creating appeal",id:"creating-appeal",children:[{value:"Appeal Lifecycle",id:"appeal-lifecycle",children:[]}]},{value:"Approving/Rejecting appeal",id:"approvingrejecting-appeal",children:[]}],u={toc:c};function d(e){var n=e.components,o=(0,r.Z)(e,p);return(0,i.kt)("wrapper",(0,t.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"managing-appeals"},"Managing appeals"),(0,i.kt)("h2",{id:"creating-appeal"},"Creating appeal"),(0,i.kt)("p",null,"This is the main use case of Guardian, to manage access approval for user to a particular resource. Appeal is created by a user with specifying which resource they want to access along with some other appeal options."),(0,i.kt)("h3",{id:"appeal-lifecycle"},"Appeal Lifecycle"),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(2503).Z})),(0,i.kt)("h4",{id:"request-statuses"},"Request statuses"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Pending ","(","initial status",")",": During this state, the appeal will evaluate approval steps one by one. The result from the approval steps evaluation will determine whether the appeal will be approved or rejected."),(0,i.kt)("li",{parentName:"ul"},"Rejected: The appeal has at least one failed approval step."),(0,i.kt)("li",{parentName:"ul"},"Active: The appeal has been approved. As long as the appeal is in this status, the user will have the access to the designated resource."),(0,i.kt)("li",{parentName:"ul"},"Terminated: An active access can be revoked by any authorized user at any time, or, if the appeal already exceeds the lifetime limit then it will automatically get revoked.")),(0,i.kt)("h4",{id:"actions"},"Actions"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Approve: Called when all the approval steps are passed/approved."),(0,i.kt)("li",{parentName:"ul"},"Reject: Called when there is one approval step that is rejected."),(0,i.kt)("li",{parentName:"ul"},"Revoke: A manual action that is called by an authorized user intentionally to revoke an active access."),(0,i.kt)("li",{parentName:"ul"},"Expire: If the appeal specifies the expiration policy then it will automatically get expired when it is already passed the lifetime limit."),(0,i.kt)("li",{parentName:"ul"},"Recreate: Possible for appeals that are currently still active, rejected, or terminated. This action will create a new appeal based on the previous one. For the appeal coming from active status, there is a policy related to access extension.")),(0,i.kt)("p",null,"To create an appeal, you can use this endpoint:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'POST /appeals\nContent-Type: application/json\nAccept: application/json\n\nRequest Body:\n{\n   "user": "user@email.com",\n   "resources": [\n       {\n           "id": 1,\n           "role": "viewer",\n           "options": {\n             "duration": "24h"\n           }\n       }\n   ]\n}\n\nResponse:\n[\n  {\n    "id": 1,\n    "resource_id": 1,\n    "policy_id": "bigquery_dataset",\n    "policy_version": 1,\n    "status": "pending",\n    "user": "user@email.com",\n    "role": "viewer",\n    "options": {\n      "expiration_date": "2021-05-10T09:49:26.402189+07:00"\n    },\n    "labels": null,\n    "approvals": [\n      {\n        "id": 11,\n        "name": "check_if_dataset_is_pii",\n        "appeal_id": 11,\n        "status": "pending",\n        "actor": null,\n        "policy_id": "bigquery_dataset",\n        "policy_version": 1\n      },\n      {\n        "id": 12,\n        "name": "supervisor_approval",\n        "appeal_id": 11,\n        "status": "pending",\n        "actor": null,\n        "policy_id": "bigquery_dataset",\n        "policy_version": 1,\n        "approvers": [\n          "john.doe@email.com"\n        ]\n      },\n      {\n        "id": 13,\n        "name": "admin_approval",\n        "appeal_id": 11,\n        "status": "pending",\n        "actor": null,\n        "policy_id": "bigquery_dataset",\n        "policy_version": 1,\n        "approvers": [\n          "owner@email.com"\n        ]\n      }\n    ]\n  }\n]\n')),(0,i.kt)("h2",{id:"approvingrejecting-appeal"},"Approving/Rejecting appeal"),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(9485).Z})),(0,i.kt)("p",null,"Completing an appeal to gain the access to the designated resource could consist of multiple approvals, depending on the ",(0,i.kt)("a",{parentName:"p",href:"/guardian/docs/reference/policy-config"},"approval policy")," applied to the designated resource. In Guardian, it called approval steps. Approval steps are determined during the appeal creation. For approval step without approvers, Guardian will evaluate it and resolve the status immediately. But for one with approvers, an action is required to approve/reject that particular approval step."),(0,i.kt)("p",null,"That action is can be done by using this endpoint:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'PUT /appeals/:id/approvals/:step_name\nContent-Type: application/json\nAccept: application/json\n\nParams:\nid: 1\nstep_name: supervisor_approval\n\nRequest Body:\n{\n    "action": "approve"\n}\n\nResponse:\n{\n  "id": 1,\n  "resource_id": 1,\n  "policy_id": "bigquery_dataset",\n  "policy_version": 1,\n  "status": "pending",\n  "user": "user@email.com",\n  "role": "viewer",\n  "options": {\n    "expiration_date": "2021-05-10T09:49:26.402189+07:00"\n  },\n  "labels": null,\n  "approvals": [\n    {\n      "id": 11,\n      "name": "check_if_dataset_is_pii",\n      "appeal_id": 11,\n      "status": "pending",\n      "actor": null,\n      "policy_id": "bigquery_dataset",\n      "policy_version": 1\n    },\n    {\n      "id": 12,\n      "name": "supervisor_approval",\n      "appeal_id": 11,\n      "status": "approved", // this approval step\u2019s status is updated to \u2018approved\u2019\n      "actor": null,\n      "policy_id": "bigquery_dataset",\n      "policy_version": 1,\n      "approvers": [\n        "john.doe@email.com"\n      ]\n    },\n    {\n      "id": 13,\n      "name": "admin_approval",\n      "appeal_id": 11,\n      "status": "pending",\n      "actor": null,\n      "policy_id": "bigquery_dataset",\n      "policy_version": 1,\n      "approvers": [\n        "owner@email.com"\n      ]\n    }\n  ]\n}\n')))}d.isMDXComponent=!0},2503:function(e,n,a){n.Z=a.p+"assets/images/appeal-lifecycle-fb2b03bfb17b31d0fbb164a04b73785e.png"},9485:function(e,n,a){n.Z=a.p+"assets/images/approval-flow-dbcfdbbe112b41c73571d5a9f6876df0.png"}}]);